---

- name: Check variables are defined
  assert:
    that:
      - index is defined and index != ""
      - mapping_file is defined and mapping_file != ""
    msg: "index/mapping_file is/are missing"
  tags: [ "check_vars" ]

- set_fact:
    index_override: "{{ index }}-{{ ansible_date_time.iso8601_basic_short | lower }}"

# - name: Check that the number of shards > 0
#   assert:
#     that:
#       - shards is defined and shards | int > 1
#     msg: "The number of shards must be > 1, got {{ shards }}"
#   tags: [ "check_vars" ]

# - name: Check that the number of replicas >= 0
#   assert:
#     that:
#       - shards is defined and shards | int >= 0
#     msg: "The number of replicas must be >= 0, got {{ replicas }}"
#   tags: [ "check_vars" ]

- name: Create index
  uri: 
    url: "{{ endpoint }}"
    method: PUT
    body: "{{ query }}"
    body_format: json
  delegate_to: localhost